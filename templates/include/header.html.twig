<div class="menu_up">

    <ul class="menu_right">

        {% for locale in locales if locale != app.request.locale%}
            <li style="margin-top: 4%">
                <a href="{{ path('change_locale', {'locale': locale})}}">
                    <img class="lang-en" src="{{asset('assets/images/'~locale~'.png')}}" alt="{{ locale }}" id="logo" >
                </a>
            </li>
        {% endfor %}

        <li class="dropdown">
            {% if is_granted('ROLE_PATIENT') %}
                <a class="btn btn-default dropdown-toggle pat" type="button"  data-toggle="dropdown" aria-haspopup="true" aria-hidden="false" aria-expanded="true">
                    <i  class="far fa-bell"> <span class="label label-pill label-danger cont"></span></i>

                </a>
                <ul class="dropdown-menu patient dropdown-menu-right" style="width: 300px">


                </ul>
            {% endif %}
            {% if is_granted('ROLE_PRATICIEN') %}
                <a class="btn btn-default dropdown-toggle prat" type="button"  data-toggle="dropdown" aria-haspopup="true" aria-hidden="true" aria-expanded="true">
                    <i class="far fa-bell"> <span class="label label-pill label-danger count"></span></i>
                </a>
                <ul class="dropdown-menu test dropdown-menu-right" style="width: 300px" >

                </ul>
            {% endif %}


        </li>
        <li class="position-relative profileTrigger">
            {% if is_granted('ROLE_PATIENT') %}
                <a class="btn btn-default dropdown-toggle" type="button"  data-toggle="dropdown" >
                    {% set img = (app.user.photo == null)? 'assets/images/praticien.jpg' : 'uploads/' ~ app.user.photo %}
                    <img style=" position: absolute; height: 30px" src="/{{ img }}" width="30px">

                </a>
                <ul class="dropdown-menu dropdown-menu-right" >
                   <a class="dropdown-item" style="position: relative" href="{{ path('editPatient') }}">{% trans %}My profile{% endtrans %}</a>
                    <hr>
                    <a class="dropdown-item" style="position: relative" href="{{ path('app_logout') }}">{% trans %}Logout{% endtrans %}</a>
                </ul>
            {% endif %}
            {% if is_granted('ROLE_PRATICIEN') %}
                <a class="btn btn-default dropdown-toggle" type="button"  data-toggle="dropdown">
                    {% set img = (app.user.photo == null)? 'assets/images/praticien.jpg' : 'uploads/' ~ app.user.photo %}
                    <img style=" position: absolute; height: 30px" src="/{{ img }}" width="30px">
                </a>
                <ul class="dropdown-menu dropdown-menu-right">
                    <a class="dropdown-item" href="{{ path('editPraticien') }}">{% trans %}My profile{% endtrans %}</a>
                    <hr>
                    <a class="dropdown-item" href="{{ path('app_logout') }}" >{% trans %}Logout{% endtrans %}</a>
                </ul>

            {% endif %}
        </li>
    </ul>
</div>

{% block javascripts %}
    <script src="{{ asset('assets/js/jquery-3.1.1.min.js') }}" type="text/javascript" ></script>
    <script src="{{ asset('assets/js/bootstrap.min.js') }}" type="text/javascript"></script>
    <script>
        $(document).ready(function () {
            function load_unseen_notification(view = '') {
                $.ajax({
                    url:"{{ path('notif') }}",
                    method : "POST",
                    data:{view:view},
                    dataType:"json",
                    success:function (data) {
                            $('.test').html(data.notification);
                        if(data.unseen_notification > 0){
                            $('.count').html(data.unseen_notification);
                        }
                    }
                });
            }

            load_unseen_notification();
            $(document).on('click','.prat', function () {
                $('.count').html(0);
                load_unseen_notification('yes');

            });

            function load_unseen_notificatio(view = '') {
                $.ajax({
                    url:"{{ path('noti') }}",
                    method : "POST",
                    data:{view:view},
                    dataType:"json",
                    success:function (data) {
                        $('.patient').html(data.notification);
                        if(data.unseen_notification > 0){
                            $('.cont').html(data.unseen_notification);
                        }
                    }
                });
            }
            load_unseen_notificatio();
            $(document).on('click','.pat', function () {
                $('.count').html(0);
                load_unseen_notificatio('yes');

            });

            setInterval(function () {
                load_unseen_notification();
                load_unseen_notificatio();

            },5000);


        });
    </script>

{% endblock %}