{% extends 'base.html.twig' %}

{% block title %}Register{% endblock %}

{% block body %}

    {{ form_start(registrationForm) }}
        
    <div class="background-img"></div>
<div class="body-page register">
    <div class="container text-center body-content">
        <div class="btn-back"><a href="{{ path('homepage') }}">Retour</a></div>
        <img class="logo-login" width="88px" src="{{asset('assets/images/logo_suivi.png')}}" alt="logo" id="logo">
        <h3 class="main-title mb-4">{% trans %}Register Praticien</h3>
        <form role="form" class="form-horizontal">
            <div class="row form-group">
                <div class="col-lg-6">
                {{ form_widget(registrationForm.lastname, {'attr': {'class': 'form-control', 'placeholder': 'Lastname'}}) }}
                </div>
                <div class="col-lg-6">
                {{ form_widget(registrationForm.firstname, {'attr': {'class': 'form-control', 'placeholder': 'Firstname'}}) }}
                </div>
            </div>
            <div class="row form-group">
                <div class="col-lg-6">
                {{ form_widget(registrationForm.date_naissance, {'attr': {'class': 'form-control', 'placeholder': 'Date of Birth'}}) }}
                </div>
                <div class="col-lg-6">
                {{ form_widget(registrationForm.lieu_naissance, {'attr': {'class': 'form-control', 'placeholder': 'Place of birth'}}) }}
                </div>
            </div>
            <div class="row form-group">
                <div class="col-lg-6">
                {{ form_widget(registrationForm.phone, {'attr': {'class': 'form-control', 'placeholder': 'Phone'}}) }}
                </div>
                <div class="col-lg-6">
                {{ form_widget(registrationForm.phone_professional, {'attr': {'class': 'form-control', 'placeholder': 'Professional phone '}}) }}
                </div>
            </div>
            <div class="row form-group">
                <div class="col-lg-6">
                    {{ form_widget(registrationForm.fonction, {'attr': {'class': 'form-control', 'placeholder': 'Function'}}) }}
                </div>
                <div class="col-lg-6">
                    {{ form_widget(registrationForm.address, {'attr': {'class': 'form-control', 'placeholder': 'Adress'}}) }}
                </div>
            </div>
            <div class="row form-group">
                <div class="col-lg-12">
                    {{ form_widget(registrationForm.email, {'attr': {'class': 'form-control', 'placeholder': 'e-mail'}}) }}
                </div>
            </div>
             <div class="row form-group">
                <div class="col-lg-6">
                {{ form_widget(registrationForm.username, {'attr': {'class': 'form-control', 'placeholder': 'Your username'}}) }}
                </div>
                <div class="col-lg-6">
                {{ form_widget(registrationForm.plainPassword, {'attr': {'class': 'form-control', 'placeholder': 'Password'}}) }}
                </div>
            </div>
            <button type="submit " class="btn btn-info button-login mb-3">
                {% trans %}Register{% endtrans %}
            </button>
        
    {{ form_end(registrationForm) }}
    </div>
</div>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script>
        function getRndInteger(min = 100, max= 1000) {
            return Math.floor(Math.random() * (max - min + 1) ) + min;
        }

        function createUsername()  {
            var fname = $('#registration_praticien_form_firstname').val().substring(0,1).toLowerCase();

            var lname = $('#registration_praticien_form_lastname').val().toLowerCase();
            var username = fname + lname + getRndInteger();

            $.ajax({
                url: "{{ path('check_username') }}",
                type: 'POST',
                data: {
                    'username': username,
                },
                dataType: "json",
                success: (data) => {
                    console.log(data);
                    if (data.status == "OK"){
                        $('#registration_praticien_form_username').val(username);
                    }else {
                        createUsername();
                    }
                },
                error: (e) => {
                    console.log(error);
                }
            }).done(() => {
            });
            //$('#registration_form_email').val(username);
        }

        $(document).ready(function () {
            $('#form-parent').css("display", "none");
            $('#registration_praticien_form_username').attr("readonly", "true");
            $("#registration_form_type_patient").on('change', function (e) {
                if ($("#registration_form_type_patient").val() == 3){
                    $('#form-parent').css("display", "block");
                }else {
                    $('#form-parent').css("display", "none");
                }
            });

            $('#registration_praticien_form_firstname').on('keyup', createUsername);
            $('#registration_praticien_form_lastname').on('keyup', createUsername);
        });
    </script>
{% endblock %}
