{% extends 'base.html.twig' %}

{% block title %}Register{% endblock %}

{% block body %}

    {{ form_start(registrationForm) }}
        
    <div class="background-img"></div>
<div class="body-page register">
    <div class="container text-center body-content">
        <img class="logo-login" width="88px" src="{{asset('assets/images/logo_suivi.png')}}" alt="logo" id="logo">
        <h3 class="main-title mb-4">S'inscrire patient</h3>
        <form role="form" class="form-horizontal">
            <div class="row form-group">
                <div class="col-lg-6">
                {{ form_widget(registrationForm.lastname, {'attr': {'class': 'form-control', 'placeholder': 'Nom'}}) }}
                </div>
                <div class="col-lg-6">
                {{ form_widget(registrationForm.firstname, {'attr': {'class': 'form-control', 'placeholder': 'Prénom(s)'}}) }}
                </div>
            </div>
            <div class="row form-group">
                <div class="col-lg-6">
                {{ form_widget(registrationForm.date_naissance, {'attr': {'class': 'form-control', 'placeholder': 'Date de Naissance'}}) }}
                </div>
                <div class="col-lg-6">
                {{ form_widget(registrationForm.lieu_naissance, {'attr': {'class': 'form-control', 'placeholder': 'Lieu de Naissance'}}) }}
                </div>
            </div>
            <div class="row form-group">
                <div class="col-lg-6">
                {{ form_widget(registrationForm.phone, {'attr': {'class': 'form-control', 'placeholder': 'Téléphone'}}) }}
                </div>
                <div class="col-lg-6">
                {{ form_widget(registrationForm.address, {'attr': {'class': 'form-control', 'placeholder': 'Adresse'}}) }}
                </div>
            </div>
            <div class="row form-group">
                <div class="col-lg-12">
                    {{ form_widget(registrationForm.email, {'attr': {'class': 'form-control', 'placeholder': 'Votre adresse e-mail'}}) }}
                </div>
            </div>
             <div class="row form-group">
                <div class="col-lg-6">
                {{ form_widget(registrationForm.username, {'attr': {'class': 'form-control', 'placeholder': 'Votre identifiant'}}) }}
                </div>
                <div class="col-lg-6">
                {{ form_widget(registrationForm.plainPassword, {'attr': {'class': 'form-control', 'placeholder': 'Mot de passe'}}) }}
                </div>
            </div>
            <div class="row form-group">
                <div class="col-lg-6">
                    {{ form_widget(registrationForm.type_patient, {'attr': {'class': 'form-control', 'placeholder': 'Type patient'}}) }}
                </div>
                <div class="col-lg-6">
                    {{ form_widget(registrationForm.sexe, {'attr': {'class': 'form-control', 'placeholder': 'Sexe'}}) }}
                </div>
            </div>
            <div class="row form-group" id="form-parent">
                <div class="col-md-12">
                	{{ form_widget(registrationForm.namedaddy, {'attr': {'class': 'form-control mb-3', 'placeholder': 'nom de père'}}) }}
                </div>
                <div class="col-md-12">
                	{{ form_widget(registrationForm.namemonther, {'attr': {'class': 'form-control mb-3', 'placeholder': 'nom de mère'}}) }}
                </div>
            </div>
            <button type="submit " class="btn btn-info button-login mb-3">
                S'inscrire
            </button>
        
    {{ form_end(registrationForm) }}
    </div>
</div>
{% endblock %}
{% block javascripts %} 
    {{ parent() }}
    <script>
        function getRndInteger(min = 100, max= 1000) {
            return Math.floor(Math.random() * (max - min + 1) ) + min;
        }

        function createUsername()  {
            var fname = $('#registration_form_firstname').val().substring(0,1).toLowerCase();

            var lname = $('#registration_form_lastname').val().toLowerCase();
            var username = fname + lname + getRndInteger();

            $.ajax({
                url: "{{ path('check_username') }}",
                type: 'POST',
                data: {
                    'username': username,
                },
                dataType: "json",
                success: (data) => {
                    console.log(data);
                    if (data.status == "OK"){
                        $('#registration_form_username').val(username);
                    }else {
                        createUsername();
                    }
                },
                error: (e) => {
                    console.log(error);
                }
            }).done(() => {
            });
            //$('#registration_form_email').val(username);
        }

        $(document).ready(function () {
            $('#form-parent').css("display", "none");
            $('#registration_form_username').attr("readonly", "true");
            $("#registration_form_type_patient").on('change', function (e) {
                if ($("#registration_form_type_patient").val() == 3){
                    $('#form-parent').css("display", "block");
                }else {
                    $('#form-parent').css("display", "none");
                }
            });

            $('#registration_form_firstname').on('keyup', createUsername);
            $('#registration_form_lastname').on('keyup', createUsername);
        });
    </script>
{% endblock %}
