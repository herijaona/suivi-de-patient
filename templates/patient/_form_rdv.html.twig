{% extends 'include/base.html.twig' %}

{%  block title %}
    {% trans %}Appointment {% endtrans %}
{% endblock %}
{% block stylesheets %}

    <style>
        .md-form.row-check {
            flex-direction: row;
            display: flex;
        }
        .association-form {
            display: none;
        }
    </style>
{% endblock %}

{% block body %}

    <div class="modal-header text-center">
        {% if new == true %}
            <h4 class="modal-title white-text w-100 font-weight-bold py-2">{% trans %}MAKE AN APPOINTMENT WITH MY PRATICIEN{% endtrans %}</h4>
        {% else %}
            <h4 class="modal-title white-text w-100 font-weight-bold py-2">
                {% trans %}Appointment modification{% endtrans %}
            </h4>
        {% endif %}
    </div>
    <!--Content-->
    {{ form_start(form, {'attr': {'action': path('register_rdv') }}) }}
    <!--Body-->
    <div class="modal-body" style="width:69%; margin-left: 17%">
        <div class="md-form">
            <label class="active" for="form1">Fonction </label>
            {{ form_widget(form.fonction, {'attr': { 'class': 'form-control chosen-select' }}) }}
        </div>
        <div class="md-form">
            <label class="active" for="form1">{% trans %}Country{% endtrans %} </label>
            <select class="form-control " id="state" name="state" required >
                <option value="" selected>{% trans %}Country{% endtrans %}</option>
            </select>
        </div>
        <div class="md-form">
            <label class="active" for="form1">{% trans %}City{% endtrans %} </label>
            <select class="form-control " id="city" name="city" required >
                <option value="" selected>{% trans %}City{% endtrans %}</option>
            </select>
        </div>
        <div class="md-form">
            <label class="active" for="form1">Praticien</label>
            <select class="form-control" id="praticien" name="praticien" required >
                <option value="" selected>Praticien</option>
            </select>
        </div>
        <div class="md-form">
            <label class="active" for="form1">Type</label>
            {{ form_widget(form.typeRdv, {'attr': { 'class': 'form-control chosen-select' }}) }}
        </div>
        <div class="md-form description">
            <label class="active" for="form1">{% trans %}Object{% endtrans %}</label>
            {{ form_widget(form.objet, {'attr': { 'class': 'form-control' }}) }}
        </div>


        <div class="md-form association-form ">
            <label class="active" for="form1"  style="position: absolute">{% trans %}Associate{% endtrans %} </label>
            {{ form_widget(form.Associer, {'attr': { 'class': 'form-control' }}) }}
        </div>
        <div class="md-form" style="display: none">
            {{ form_widget(form.dateRdv, {'attr': { 'class': 'form-control' }}) }}
            {{ form_widget(form.heureRdv, {'attr': { 'class': 'form-control' }}) }}


        </div>

    </div>
    <div class="modal-footer justify-content-center">
        <button type="button" class="btn btn-outline-danger waves-effect" data-dismiss="modal" aria-label="Close"><i class="fas fa-remove ml-1"></i> {% trans %}Cancel{% endtrans %} </button>
        <button type="submit" class="btn btn-outline-primary waves-effect submit_new_center_health"><i class="fas fa-save ml-1"></i> {% trans %}Save{% endtrans %} </button>
    </div>

    {{ form_end(form) }}
{% endblock %}

{% block javascripts %}
    <script type="text/javascript">
        $(document).ready(function () {
            $('#rdv_fonction').on('change', function () {
                var idfonction = $('#rdv_fonction option:selected').val();
                $.ajax({
                    method: "POST",
                    url: "{{ path('fonction_country') }}",
                    data: {id: idfonction},
                    success: function (response) {
                        $('#state').empty();
                        $.each(response, function (index, element) {
                            $('#state').append('<option value="' + element.id + '" selected="selected">' + element.nameState + ' </option>');
                        });
                    }
                });
            });
            $('#state').on('click', function () {
                var idfonction = $('#rdv_fonction option:selected').val();
                var idstate = $('#state option:selected').val();
                $.ajax({
                    method: "POST",
                    url: "{{ path('fonction_city') }}",
                    data: {id: idfonction, state:idstate},
                    success: function (response) {
                        $('#city').empty();
                        $.each(response, function (index, element) {
                            $('#city').append('<option value="' + element.id + '" selected="selected">' + element.nameCity + ' </option>');
                        });
                    }
                });
            });
            $('#city').on('click', function () {
                var idfonction = $('#rdv_fonction option:selected').val();
                var idstate = $('#state option:selected').val();
                var idcity = $('#city option:selected').val();
                $.ajax({
                    method: "POST",
                    url: "{{ path('fonction_praticien') }}",
                    data: {id: idfonction, state:idstate, city:idcity},
                    success: function (response) {
                        $('#praticien').empty();
                        $.each(response, function (index, element) {
                            $('#praticien').append('<option value="' + element.id + '" selected="selected">' + element.lastName +'  '+ element.firstName +' </option>');
                        });
                    }
                });
            });

            $('.association-form').css("display", "none");
            $('.chosen-select').chosen({width: "100%"});

            $('#rdv_heureRdv').on('change', function () {
                let receivedVal = $(this).val();
                $(this).val(receivedVal );
            });

            $('#praticien').on('click', function (e) {

                var particien = $(this).val();
                var url = "{{ path('check_association', { "praticien": "id"}) }}";
                url = url.replace("id", particien);
                $.ajax({
                    url: url,
                    type: 'post',
                    dataType: "json",
                    success: (data) => {

                        if(data.status == "OK"){
                            $('.association-form').css('display', 'none');
                        }else{
                            $('.association-form').css('display', 'block');
                        }
                    },
                    error: (e) => {
                    }
                }).done(() => {
                });
            });
            $('.chosen-select').trigger('chosen:updated');
        });
    </script>

{% endblock %}