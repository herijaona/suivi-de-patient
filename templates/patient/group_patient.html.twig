{% extends 'include/base.html.twig' %}
{%  block title %}
   {% trans %}Group - Family{% endtrans %}
{% endblock %}
{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{asset('vendor/datatables-bs4/css/dataTables.bootstrap4.css')}}">
    <style>
        .close {
            line-height: 1.5 !important;
            padding: .84rem 2.14rem !important;
        }
    </style>
{% endblock %}

{% block body %}
    <div class="row head-table col-md-12">
        <div class="grid-title-table col-md-9 mt-4">
            <h4 class="h4-content"></h4>
        </div>

            <div class="grid-edit-btn col-md-3 mt-3">
                <button class="btn btn-danger suppr" style="width: 276px; font-size: 18px; font-weight: bold; padding: 1px !important;" data-toggle="modal" data-target="#orangeModalSubscription">{% trans %}+ New Member{% endtrans %}</button>
            </div>

    </div>
    <div class="row-table table-content">
        {% for my_group in my_groups  %}
        <p style="color: #f0f0f0; background-color: #0f9d58;text-align: center; width: max-content;padding: 8px; font-weight: bold;">{{ my_group.Name }}</p>
        {% endfor %}
        <table class="table table-striped" id="example1">

            <thead>
            <tr>
                <th>{% trans %}Last Name {% endtrans %}</th>
                <th>{% trans %}First Name {% endtrans %}</th>
                <th>{% trans %}Membre ID {% endtrans %}</th>
                <th>Action</th>

                <th>{% trans %}Referent{% endtrans %}</th>
            </tr>
            </thead>
            <tbody>
            {% for family in family %}
                <tr>
                    <td>
                        {{ family.lastName }}
                    </td>
                    <td>
                        {{ family.firstName }}
                    </td>
                    <td>
                        {{ family.username }}
                    </td>

                    <td>
                        <span class="delete_membres_group suppr" data-id-group="{{ groupe.id }}" data-id-mmb="{{ family.patient }}"><i class="fa fa-trash"></i></span>
                    </td>

                    <td>
                        {% if family.Referent == 1 %}
                            OUI
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}

            </tbody>
        </table>
    </div>
    <div class="modal fade" id="orangeModalSubscription" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-notify modal-primary" role="document">
            <!--Content-->
            <form action="{{ path('add_new_membres_group') }}" method="post">
                <div class="modal-content">
                    <!--Header-->
                    <div class="modal-header text-center">
                        <h4 class="modal-title white-text w-100 font-weight-bold py-2 title_modal">{% trans %}Add new member{% endtrans %}</h4>

                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true" class="white-text">&times;</span>
                        </button>
                    </div>

                    <!--Body-->

                    <div class="modal-body">
                        {% for message in app.flashes('error') %}
                            <div class="alert alert-danger">
                                {{ message }}
                            </div>
                        {% endfor %}
                        {% for message in app.flashes('success') %}
                            <div class="alert alert-success">
                                {{ message }}
                            </div>
                        {% endfor %}
                      <input type="hidden" name="group" id="group" class="form-control" value={{ groupe.id }} >
                        <div style="margin-left: 0"  class="form-group row">
                            <label for="idP" style="background-color: #4682B4; color: #f0f0f0; font-size: 18px; padding: 15px;" class="col-md-4 ">{% trans %}Patient ID :{% endtrans %}</label>
                            <div class="col-md-4">
                                <input type="text" id="idP" name="idP"  style=" width: 302px; padding: 14px;background-color: #4682B4;margin-left: -10px; color: #f0f0f0;" required >
                            </div>
                        </div>
                        <div  class="form-group row" style="margin-top: -16px !important;">
                            <button type="button" class="btn btn-danger" style="width: 161px; padding: 15px; color: #0d0d0d;font-weight: bold;margin-left: 14px;" data-dismiss="modal" aria-label="Close"><i class="fas fa-remove ml-1"></i> {% trans %}CANCEL{% endtrans %} </button>
                            <button type="submit" class="btn btn-success " style="width: 303px; margin-left: 5px; padding: 15px;color: #0d0d0d; font-weight: bold"><i class="fas fa-save ml-1"></i> {% trans %}VALIDATE{% endtrans %} </button>

                        </div>
                    </div>
                </div>
            </form>
            <!--/.Content-->
        </div>
    </div>

{% endblock %}

{% block javascripts %}
    <!-- DataTables -->
    <script src="{{asset('vendor/datatables/jquery.dataTables.js')}}"></script>
    <script src="{{asset('vendor/datatables-bs4/js/dataTables.bootstrap4.js')}}"></script>
    <script>
        $('.suppr').css("display", "none");
        $('.data-edit').on('click', function (e) {
            e.preventDefault();
            var id = $(this).data('id');
            var name = $(this).data('name');
            $('#group_id').val(id);
            $('#group_name').val(name);
            $('.title_modal').html('Modification de nom de groupe');
            $('#orangeModalSubscription').modal('show');
        });
        $('.see_group').on('click', function (e) {
            e.preventDefault();
            var href = $(this).data('href');
            location.href =  href;
        });
        $('.delete_membres_group').on('click', function(e) {
            e.preventDefault();
            var id_group = $(this).data('id-group');
            var id_membre = $(this).data('id-mmb');
            var result = confirm("Are you sure you want to delete from this group?");
            if (result) {
                var url = "{{ path('delete_membres_group') }}";
                $.ajax({
                    url: url,
                    type: 'POST',
                    data: {
                        id_group: id_group,
                        id_membre: id_membre
                    },
                    success: (data) => {
                        if (data.status) {
                            location.reload()
                        }
                    },
                    error: (e) => {
                        console.log(error);
                    }
                }).done(() => {});
            } else {
                return false;
            }
        });

        {% if is_granted('ROLE_PATIENT') %}
        $.ajax({
            url: "{{ path('family_action') }}",
            type: 'post',
            data: {
                id_group: $('#group').val()

            },
            dataType: "json",
            cache: false,
            success:function(data)
            {
                if(data != 0){
                    $(".suppr").css("display", "block");
                }
                else {
                    $(".suppr").css("display", "none");
                }

            }
        });
        {% endif %}


    </script>
{% endblock %}